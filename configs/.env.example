# ============================================================
# Secure Audio Upload Pipeline - Configuration
# ============================================================

# --- Général ---
ENVIRONMENT=development
LOG_LEVEL=INFO
SECRET_KEY=change-me-in-production-use-openssl-rand-hex-32

# --- Codes QR / Sessions ---
CODE_TTL_MINUTES=15
CODE_TTL_MAX_MINUTES=4320
ALLOW_SHORT_QR_TTL_SECONDS_TEST=false
MAX_UPLOADS_PER_SESSION=5
UPLOAD_STATUS_VIEW_TTL_MINUTES=60
UPLOAD_EXPIRY_GRACE_SECONDS=300
CODE_LENGTH=6

# --- OIDC / Keycloak ---
OIDC_ISSUER=http://keycloak:8080/realms/audio-upload
OIDC_INTERNAL_ISSUER=http://keycloak:8080/realms/audio-upload
OIDC_CLIENT_ID=audio-upload-app
OIDC_CLIENT_SECRET=change-me
OIDC_REDIRECT_URI=http://localhost:8080/auth/callback

# --- PostgreSQL Zone Externe ---
EXT_DB_HOST=postgres-external
EXT_DB_PORT=5432
EXT_DB_NAME=audio_upload_ext
EXT_DB_USER=audio_ext
EXT_DB_PASSWORD=change-me-ext

# --- PostgreSQL Zone Interne ---
INT_DB_HOST=postgres-internal
INT_DB_PORT=5432
INT_DB_NAME=audio_upload_int
INT_DB_USER=audio_int
INT_DB_PASSWORD=change-me-int

# --- RabbitMQ ---
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=audio
RABBITMQ_PASSWORD=change-me-rabbit
RABBITMQ_VHOST=audio_pipeline

# --- S3 / MinIO - 3 Buckets séparés ---
# Bucket 1 : Upload staging (zone externe, fichiers bruts)
S3_UPLOAD_ENDPOINT=http://minio-upload:9000
S3_UPLOAD_ACCESS_KEY=minioadmin
S3_UPLOAD_SECRET_KEY=minioadmin
S3_UPLOAD_BUCKET=upload-staging
S3_UPLOAD_REGION=us-east-1

# Bucket 2 : Processed staging (zone externe, fichiers traités)
S3_PROCESSED_ENDPOINT=http://minio-processed:9000
S3_PROCESSED_ACCESS_KEY=minioadmin
S3_PROCESSED_SECRET_KEY=minioadmin
S3_PROCESSED_BUCKET=processed-staging
S3_PROCESSED_REGION=us-east-1

# Bucket 3 : Internal storage (zone interne)
S3_INTERNAL_ENDPOINT=http://minio-internal:9000
S3_INTERNAL_ACCESS_KEY=minioadmin
S3_INTERNAL_SECRET_KEY=minioadmin
S3_INTERNAL_BUCKET=internal-storage
S3_INTERNAL_REGION=us-east-1

# --- ClamAV ---
CLAMAV_HOST=clamav
CLAMAV_PORT=3310

# --- FFmpeg / Transcodage ---
TRANSCODE_OUTPUT_FORMAT=wav
TRANSCODE_SAMPLE_RATE=16000
TRANSCODE_CHANNELS=1
TRANSCODE_BITRATE=256k
# Filtrage voix : bandpass 80Hz-8kHz + normalisation loudnorm
FFMPEG_AUDIO_FILTER=highpass=f=80,lowpass=f=7000,loudnorm=I=-16:TP=-1.5:LRA=11
ENABLE_LOUDNORM=true
POST_LOUDNORM_FILTER_CHAIN=highpass=f=80,lowpass=f=7000,alimiter=limit=0.95

# --- File Mover / Puller ---
INTERNAL_API_URL=http://file-puller:8090/api/v1/pull
INTERNAL_API_TOKEN=replace_with_32plus_random_secret_token_9xQ7mB4p
PULL_CHECK_INTERVAL_SECONDS=10

# --- Token Issuer (Zone Interne) ---
TOKEN_ISSUER_API_URL=http://token-issuer:8091/api/v1/issue-token
TOKEN_ISSUER_PORT=8091

# --- Transcription Stub ---
TRANSCRIPTION_SIMULATE_DELAY_SECONDS=5

# --- Upload Portal ---
UPLOAD_PORTAL_HOST=0.0.0.0
UPLOAD_PORTAL_PORT=8081
UPLOAD_MAX_FILE_SIZE_MB=100
ALLOWED_AUDIO_EXTENSIONS=mp3,wav,ogg,flac,m4a,aac,wma,opus,webm
EXTERNAL_PURGE_INTERVAL_SECONDS=86400
EXTERNAL_PURGE_MAX_AGE_HOURS=12

# --- Code Generator ---
CODE_GENERATOR_HOST=0.0.0.0
CODE_GENERATOR_PORT=8080
UPLOAD_PORTAL_BASE_URL=http://localhost:8081

# --- Purge Intranet ---
INTERNAL_PURGE_INTERVAL_SECONDS=86400
INTERNAL_PURGE_MAX_AGE_DAYS=7

# --- Admin Portal ---
NORMALIZATION_CACHE_TTL_SECONDS=3600
NORMALIZATION_MAX_COMPUTE_PER_REFRESH=0
